<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Building Images with BuildConfigs and ImageStreams | Turple.ca</title><meta name="description" content="Turple.ca">
    <link rel="preload" href="/assets/style-c0f6d13d.css" as="style"><link rel="stylesheet" href="/assets/style-c0f6d13d.css">
    <link rel="modulepreload" href="/assets/app-8dfab3ee.js"><link rel="modulepreload" href="/assets/building-s2i.html-3fa763dc.js"><link rel="modulepreload" href="/assets/building-s2i.html-3c7c69b8.js"><link rel="prefetch" href="/assets/index.html-23b33267.js" as="script"><link rel="prefetch" href="/assets/container_configurations.html-1ff0d521.js" as="script"><link rel="prefetch" href="/assets/index.html-4925405c.js" as="script"><link rel="prefetch" href="/assets/nginx_deployment_to_kubernetes.html-be74e122.js" as="script"><link rel="prefetch" href="/assets/index.html-350ce240.js" as="script"><link rel="prefetch" href="/assets/index.html-fbbcdea9.js" as="script"><link rel="prefetch" href="/assets/index.html-c8844095.js" as="script"><link rel="prefetch" href="/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/assets/index.html-f5b99db6.js" as="script"><link rel="prefetch" href="/assets/container_configurations.html-68ea6b30.js" as="script"><link rel="prefetch" href="/assets/index.html-eebcb2b1.js" as="script"><link rel="prefetch" href="/assets/nginx_deployment_to_kubernetes.html-dd3c1c48.js" as="script"><link rel="prefetch" href="/assets/index.html-7728b620.js" as="script"><link rel="prefetch" href="/assets/index.html-b412e5fc.js" as="script"><link rel="prefetch" href="/assets/index.html-d5fc9c78.js" as="script"><link rel="prefetch" href="/assets/404.html-43ee7913.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Turple.ca</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/sturple/sturple.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/sturple/sturple.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Building Images with BuildConfigs and ImageStreams <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/openshift/building-s2i.html#object" class="router-link-active router-link-exact-active sidebar-item" aria-label="Object"><!--[--><!--]--> Object <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/openshift/building-s2i.html#prerequisites" class="router-link-active router-link-exact-active sidebar-item" aria-label="Prerequisites"><!--[--><!--]--> Prerequisites <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/openshift/building-s2i.html#setup" class="router-link-active router-link-exact-active sidebar-item" aria-label="Setup"><!--[--><!--]--> Setup <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/openshift/building-s2i.html#the-imagestream" class="router-link-active router-link-exact-active sidebar-item" aria-label="The ImageStream"><!--[--><!--]--> The ImageStream <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/openshift/building-s2i.html#the-buildconfig" class="router-link-active router-link-exact-active sidebar-item" aria-label="The BuildConfig"><!--[--><!--]--> The BuildConfig <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/openshift/building-s2i.html#build-config-example-1-from-repository" class="router-link-active router-link-exact-active sidebar-item" aria-label="Build Config Example 1 from Repository"><!--[--><!--]--> Build Config Example 1 from Repository <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/openshift/building-s2i.html#build-config-example-2-with-source-image-from-repository" class="router-link-active router-link-exact-active sidebar-item" aria-label="Build Config Example 2 with Source Image from Repository"><!--[--><!--]--> Build Config Example 2 with Source Image from Repository <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/openshift/building-s2i.html#build-config-example-3-inline-dockerfile" class="router-link-active router-link-exact-active sidebar-item" aria-label="Build Config Example 3 Inline Dockerfile"><!--[--><!--]--> Build Config Example 3 Inline Dockerfile <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="buildconfigs-and-imagestream" tabindex="-1"><a class="header-anchor" href="#buildconfigs-and-imagestream" aria-hidden="true">#</a> BuildConfigs and ImageStream</h1><h2 id="object" tabindex="-1"><a class="header-anchor" href="#object" aria-hidden="true">#</a> Object</h2><p>To understand how BuildConfigs and ImageStreams are used to create images that are used in Kubernetes containers. The examples that will be used in this tutorial is a Nginx server.</p><h2 id="prerequisites" tabindex="-1"><a class="header-anchor" href="#prerequisites" aria-hidden="true">#</a> Prerequisites</h2><ul><li>OpenShift Instance</li><li>Terminal program</li><li><a href="https://docs.openshift.com/container-platform/4.14/cli_reference/openshift_cli/getting-started-cli.html" target="_blank" rel="noopener noreferrer">oc command line tool<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Documentation: <ul><li><a href="https://docs.openshift.com/container-platform/4.14/openshift_images/image-streams-manage.html" target="_blank" rel="noopener noreferrer">ImageStreams<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://docs.openshift.com/container-platform/4.14/rest_api/image_apis/imagestream-image-openshift-io-v1.html" target="_blank" rel="noopener noreferrer">ImageStream API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.openshift.com/container-platform/4.14/cicd/builds/understanding-buildconfigs.html" target="_blank" rel="noopener noreferrer">BuildConfigs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://docs.openshift.com/container-platform/4.14/rest_api/workloads_apis/buildconfig-build-openshift-io-v1.html#buildconfig-build-openshift-io-v1" target="_blank" rel="noopener noreferrer">BuildConfig API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></li></ul><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>There is no namespaces included with ImageStreams BuildConfig or Pod deployments. When you are using oc command lines to apply a configuration, it will use your existing context. please use the <code>oc project &lt;yournamespace&gt;</code> before running any of these commands</p></div><h2 id="setup" tabindex="-1"><a class="header-anchor" href="#setup" aria-hidden="true">#</a> Setup</h2><p>In order to start this tutorial, login to openshift through the terminal, and then switch to your namespace.</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code>oc project <span class="token operator">&lt;</span>yournamespace<span class="token operator">&gt;</span>
</code></pre></div><h2 id="the-imagestream" tabindex="-1"><a class="header-anchor" href="#the-imagestream" aria-hidden="true">#</a> The ImageStream</h2><blockquote><p>Image streams provide a means of creating and updating container images in an on-going way. As improvements are made to an image, tags can be used to assign new version numbers and keep track of changes. This document describes how image streams are managed.</p></blockquote><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment">## Run to deploy nginx ImageStream</span>
oc apply <span class="token parameter variable">-f</span> https://turple.ca/code/openshift/nginx-image-stream.yaml
</code></pre></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> ImageStream
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> image.openshift.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> Nginx Image stream with templates for NGINX_PORT and NGINX_HOST
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>image
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kind: <strong>ImageStream</strong> - defines the type of resource</li><li>apiVersion: <strong>image.openshift.io/v1</strong> - this gives the specification</li><li>metadata.name - <strong>nginx</strong> - will be how we identify this resource</li></ul><h2 id="the-buildconfig" tabindex="-1"><a class="header-anchor" href="#the-buildconfig" aria-hidden="true">#</a> The BuildConfig</h2><blockquote><p>The build config is the instruction on how your image will get build, from source, docker or as a multi-build.</p></blockquote><h3 id="build-config-example-1-from-repository" tabindex="-1"><a class="header-anchor" href="#build-config-example-1-from-repository" aria-hidden="true">#</a> Build Config Example 1 from Repository</h3><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment">## Run to deploy nginx BuildConfig</span>
oc apply <span class="token parameter variable">-f</span> https://turple.ca/code/openshift/nginx-image-build.yaml
<span class="token comment">## Create a build and follow</span>
oc build-start <span class="token parameter variable">-F</span> nginx-build-config
</code></pre></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> BuildConfig
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> build.openshift.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>build<span class="token punctuation">-</span>config
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> This builds the nginx image from GIT source.
<span class="token key atrule">strategy</span><span class="token punctuation">:</span>
  <span class="token key atrule">dockerStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">forcePull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">successfulBuildsHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">failedBuildsHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">runPolicy</span><span class="token punctuation">:</span> Serial
  <span class="token key atrule">source</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Git
    <span class="token key atrule">git</span><span class="token punctuation">:</span>
      <span class="token key atrule">ref</span><span class="token punctuation">:</span> master
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/sturple/sturple.github.io.git
    <span class="token key atrule">contextDir</span><span class="token punctuation">:</span> docker/nginx
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Docker
    <span class="token key atrule">dockerStrategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">dockerfilePath</span><span class="token punctuation">:</span> Dockerfile.template
      <span class="token key atrule">buildArgs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CODE_VERSION
        <span class="token key atrule">value</span><span class="token punctuation">:</span>  1.24.0
  <span class="token key atrule">output</span><span class="token punctuation">:</span>
    <span class="token key atrule">to</span><span class="token punctuation">:</span>
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> ImageStreamTag
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>template
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Source of code is this repo, with the context directory of <a href="https://github.com/sturple/sturple.github.io/tree/master/docker/nginx" target="_blank" rel="noopener noreferrer">docker/nginx<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, and uses the <a href="https://github.com/sturple/sturple.github.io/blob/master/docker/nginx/Dockerfile.template" target="_blank" rel="noopener noreferrer">Dockerfile.template<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>This gets build to the nginx image with a tag of template <code>nginx:template</code></li></ul><h4 id="dockerfile-template" tabindex="-1"><a class="header-anchor" href="#dockerfile-template" aria-hidden="true">#</a> Dockerfile.template</h4><div class="language-docker line-numbers-mode" data-ext="docker"><pre class="language-docker"><code><span class="token comment"># Dockerfile.template - used to create an Nginx image with templates.</span>
<span class="token instruction"><span class="token keyword">ARG</span> CODE_VERSION=latest</span>
<span class="token instruction"><span class="token keyword">FROM</span> nginx:<span class="token variable">${CODE_VERSION}</span></span>
<span class="token comment"># As of Nginx 1.19 you can use templates</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./default.conf.template /etc/nginx/templates/</span>
<span class="token comment"># Fix up permissions</span>
<span class="token instruction"><span class="token keyword">RUN</span> chmod -Rf 0777 /tmp /var /run /etc /mnt || :</span>
<span class="token comment"># Switch to usermode</span>
<span class="token instruction"><span class="token keyword">USER</span> 104</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="default-conf-template" tabindex="-1"><a class="header-anchor" href="#default-conf-template" aria-hidden="true">#</a> default.conf.template</h4><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>#default.conf.template
server {
   listen       ${NGINX_PORT};
   listen  [::]:${NGINX_PORT};
   server_name  ${NGINX_HOST};

   #access_log  /var/log/nginx/host.access.log  main;

   location / {
       root   /usr/share/nginx/html;
       index  index.html index.htm;
   }

   #error_page  404              /404.html;

   # redirect server error pages to the static page /50x.html
   #
   error_page   500 502 503 504  /50x.html;
   location = /50x.html {
       root   /usr/share/nginx/html;
   }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="build-config-example-2-with-source-image-from-repository" tabindex="-1"><a class="header-anchor" href="#build-config-example-2-with-source-image-from-repository" aria-hidden="true">#</a> Build Config Example 2 with Source Image from Repository</h3><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment">## Run to deploy nginx BuildConfig</span>
oc apply <span class="token parameter variable">-f</span> https://turple.ca/code/openshift/nginx-image-build-source.yaml
<span class="token comment">## Create a build and follow</span>
oc build-start <span class="token parameter variable">-F</span> nginx-build-source-config
</code></pre></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> BuildConfig
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> build.openshift.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>build<span class="token punctuation">-</span>source<span class="token punctuation">-</span>config
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> This builds the nginx image from GIT source.
<span class="token key atrule">strategy</span><span class="token punctuation">:</span>
  <span class="token key atrule">dockerStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">forcePull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">successfulBuildsHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">failedBuildsHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">runPolicy</span><span class="token punctuation">:</span> Serial
  <span class="token key atrule">source</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Git
    <span class="token key atrule">git</span><span class="token punctuation">:</span>
      <span class="token key atrule">ref</span><span class="token punctuation">:</span> master
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/sturple/sturple.github.io.git
    <span class="token key atrule">contextDir</span><span class="token punctuation">:</span> docker/nginx
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Docker
    <span class="token key atrule">dockerStrategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">from</span><span class="token punctuation">:</span>
        <span class="token key atrule">kind</span><span class="token punctuation">:</span> DockerImage
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.23.3<span class="token punctuation">-</span>alpine
      <span class="token key atrule">dockerfilePath</span><span class="token punctuation">:</span> Dockerfile.template
      <span class="token key atrule">buildArgs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CODE_VERSION
        <span class="token key atrule">value</span><span class="token punctuation">:</span>  1.24.0
  <span class="token key atrule">output</span><span class="token punctuation">:</span>
    <span class="token key atrule">to</span><span class="token punctuation">:</span>
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> ImageStreamTag
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>from<span class="token punctuation">-</span>source
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>This works exactly the same as example 1 with these differences <ul><li>It overwrites the <code>FROM</code> image with the image in the <code>strategy.dockerStrategy.from.name</code></li><li>This gets build to the nginx image with a tag of from-source <code>nginx:from-source</code></li></ul></li></ul><h3 id="build-config-example-3-inline-dockerfile" tabindex="-1"><a class="header-anchor" href="#build-config-example-3-inline-dockerfile" aria-hidden="true">#</a> Build Config Example 3 Inline Dockerfile</h3><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token comment">## Run to deploy nginx BuildConfig</span>
oc apply <span class="token parameter variable">-f</span> https://turple.ca/code/openshift/nginx-image-build-inline.yaml
<span class="token comment">## Create a build and follow</span>
oc build-start <span class="token parameter variable">-F</span> nginx-build-inline-config
</code></pre></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> BuildConfig
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> build.openshift.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>build<span class="token punctuation">-</span>inline<span class="token punctuation">-</span>config
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> This builds the nginx image from inline dockerfile.
<span class="token key atrule">strategy</span><span class="token punctuation">:</span>
  <span class="token key atrule">dockerStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">forcePull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">successfulBuildsHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">failedBuildsHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">runPolicy</span><span class="token punctuation">:</span> Serial
  <span class="token key atrule">source</span><span class="token punctuation">:</span>
    <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
      <span class="token comment"># Dockerfile.sed - used to create an Nginx image with new port defined by $PORT</span>
      ARG CODE_VERSION=latest
      FROM nginx<span class="token punctuation">:</span>$<span class="token punctuation">{</span>CODE_VERSION<span class="token punctuation">}</span>
      <span class="token comment"># Using sed to change port 80 to ${PORT} as port 80 is a privileged port.</span>
      RUN <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sed -i &#39;s/80/38081/g&#39; /etc/nginx/conf.d/default.conf&quot;</span><span class="token punctuation">]</span>
      <span class="token comment"># Fix up permissions</span>
      <span class="token key atrule">RUN chmod -Rf 0777 /tmp /var /run /etc /mnt ||</span> <span class="token punctuation">:</span>
      <span class="token comment"># Switch to usermode</span>
      USER 104
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Docker
    <span class="token key atrule">dockerStrategy</span><span class="token punctuation">:</span>
      <span class="token key atrule">buildArgs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CODE_VERSION
        <span class="token key atrule">value</span><span class="token punctuation">:</span>  1.25.3
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PORT
        <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token number">38081</span>
  <span class="token key atrule">output</span><span class="token punctuation">:</span>
    <span class="token key atrule">to</span><span class="token punctuation">:</span>
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> ImageStreamTag
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>port38081
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>This build uses a Docker strategy, that uses an inline Docker file.</li><li>It passes the buildArgs to pass the port and the version.</li><li>This gets build to the nginx image with a tag of port38081 <code>nginx:port38081</code></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: shawn.turple@gmail.com">S Turple</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/guide/containers/container_configurations.md" class="" aria-label="Container Configurations with Nginx"><!--[--><!--]--> Container Configurations with Nginx <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-8dfab3ee.js" defer></script>
  </body>
</html>
